# ApexQuant 项目功能说明

**答复用户**: 项目里已经有完整的策略和回测功能！

---

## ✅ 项目已有的功能

### 📈 1. 内置策略（已实现）

在 `python/apexquant/simulation/strategies.py` 中已经实现了以下策略：

#### ✅ 均线交叉策略（MA Cross Strategy）
```python
create_ma_cross_strategy(ma_short=5, ma_long=20)
```
- **原理**: MA5上穿MA20时买入，MA5下穿MA20时卖出
- **特点**: 经典趋势跟踪策略
- **适用**: 趋势明显的市场

#### ✅ RSI策略（RSI Strategy）
```python
create_rsi_strategy(rsi_period=14, oversold=30, overbought=70)
```
- **原理**: RSI < 30超卖时买入，RSI > 70超买时卖出
- **特点**: 震荡指标，适合横盘市场
- **适用**: 震荡市

#### ✅ 买入持有策略（Buy and Hold）
```python
create_buy_hold_strategy()
```
- **原理**: 开盘买入后一直持有
- **特点**: 最简单的策略，用于基准对比
- **适用**: 牛市

#### ✅ AI驱动策略（AI-Driven Strategy）
```python
create_ai_driven_strategy(ai_advisor)
```
- **原理**: 完全依靠AI（DeepSeek）决策
- **特点**: 结合市场数据和AI分析
- **适用**: 需要复杂决策的场景

---

### 🔄 2. 回测系统（已实现）

在 `SimulationController` 中已经实现了回测功能：

#### 使用方法
```python
from apexquant.simulation import SimulationController, SimulationMode

# 创建控制器
controller = SimulationController()

# 运行回测
controller.start_backtest(
    start_date="2024-01-01",
    end_date="2024-12-31",
    symbols=["sh.600519", "sh.600036"],  # 茅台、招商银行
    strategy_func=your_strategy_function,
    bar_interval="1d"  # 日线
)
```

#### 支持的功能
- ✅ **历史数据回放**: 逐日/逐Tick回放
- ✅ **模拟交易**: 完整的下单、成交、持仓管理
- ✅ **风控检查**: 止损、止盈、仓位控制
- ✅ **性能分析**: 收益率、夏普比率、最大回撤等
- ✅ **数据库记录**: 所有交易记录保存到数据库
- ✅ **可视化**: 资金曲线、回撤分析等图表

---

### 📊 3. 性能分析（已实现）

在 `PerformanceAnalyzer` 中已经实现：

#### 分析指标（20+）
```python
analyzer = PerformanceAnalyzer(db_manager, account_id)
metrics = analyzer.calculate_performance_metrics()
```

**核心指标**:
- 总收益率 / 年化收益率
- 最大回撤 / 回撤持续时间
- 夏普比率 / 卡玛比率
- 胜率 / 盈亏比
- 总交易次数 / 盈利/亏损次数
- 平均盈利/亏损

**图表功能**:
```python
# 生成所有图表
analyzer.generate_all_charts(output_dir="output")
```
- 资金曲线图
- 回撤分析图
- 交易分析图
- 月度收益热力图

---

### 💻 4. 示例代码（已提供）

在 `examples/` 目录中有多个示例：

1. **example_simple_backtest.py** - 简单回测示例
2. **example_realtime_simulation.py** - 实时模拟示例
3. **example_day2.py** ~ **example_day9.py** - 分日示例

---

## 🎯 "开始实际量化策略开发和回测" 的含义

这句话的意思是：

### 已完成 ✅
- ✅ 系统底层开发（C++核心、Python业务层）
- ✅ 基础功能测试（单元测试、集成测试）
- ✅ 问题修复（P0问题、Bug修复）
- ✅ 内置策略实现（4个策略）

### 下一步 🚀
**现在可以做的是**:

1. **使用现有策略运行回测**
   ```bash
   # 运行示例回测
   python examples/example_simple_backtest.py
   ```

2. **开发自己的策略**
   - 基于技术指标（MACD、布林带等）
   - 基于基本面（财报数据等）
   - 基于机器学习模型
   - 基于AI大模型

3. **优化策略参数**
   - 调整均线周期
   - 优化止损止盈参数
   - 测试不同股票池

4. **实盘前的准备**
   - 充分回测验证
   - 压力测试
   - 风控测试

---

## 📖 快速上手指南

### 方式1: 使用内置策略

```python
from apexquant.simulation import SimulationController
from apexquant.simulation.strategies import create_ma_cross_strategy

# 创建控制器
controller = SimulationController()

# 创建均线交叉策略
strategy = create_ma_cross_strategy(
    risk_manager=controller.risk_manager,
    ma_short=5,
    ma_long=20
)

# 运行回测
controller.start_backtest(
    start_date="2024-01-01",
    end_date="2024-12-31",
    symbols=["sh.600519"],  # 贵州茅台
    strategy_func=strategy,
    bar_interval="1d"
)

# 查看结果
from apexquant.simulation import PerformanceAnalyzer
analyzer = PerformanceAnalyzer(controller.db, controller.account_id)
metrics = analyzer.calculate_performance_metrics()
print(metrics)

# 生成图表
analyzer.generate_all_charts("output")
```

### 方式2: 开发自定义策略

```python
def my_custom_strategy(controller, bar, account_info):
    """
    自定义策略函数
    
    Args:
        controller: 模拟盘控制器
        bar: 当前K线数据 {'symbol', 'open', 'high', 'low', 'close', 'volume'}
        account_info: 账户信息 {'available_cash', 'positions', ...}
    
    Returns:
        交易信号字典或None
        {'action': 'BUY'/'SELL', 'symbol': '...', 'volume': 100, 'price': None}
    """
    symbol = bar['symbol']
    close_price = bar['close']
    
    # 你的策略逻辑
    if 你的买入条件:
        return {
            'action': 'BUY',
            'symbol': symbol,
            'volume': 100,
            'price': None  # None=市价单
        }
    elif 你的卖出条件:
        return {
            'action': 'SELL',
            'symbol': symbol,
            'volume': 100,
            'price': None
        }
    
    return None  # 无操作
```

### 方式3: 运行现有示例

```bash
# 进入项目目录
cd D:\ApexQuant

# 运行简单回测示例
python examples/example_simple_backtest.py

# 运行实时模拟示例
python examples/example_realtime_simulation.py
```

---

## 🎓 策略开发建议

### 1. 从简单开始
- 先运行内置的均线交叉策略
- 理解策略函数的结构
- 观察回测结果和图表

### 2. 学习和改进
- 修改策略参数（如MA周期）
- 添加过滤条件（如成交量过滤）
- 组合多个指标

### 3. 进阶开发
- 开发基于机器学习的策略
- 整合AI大模型（已支持DeepSeek）
- 多因子策略

### 4. 充分测试
- 不同时间段回测
- 不同股票回测
- 压力测试和极端情况测试

---

## 📁 相关文件位置

```
ApexQuant/
├── python/apexquant/simulation/
│   ├── strategies.py           # 内置策略（4个）
│   ├── simulation_controller.py # 回测控制器
│   └── performance_analyzer.py  # 性能分析
│
├── examples/
│   ├── example_simple_backtest.py      # 简单回测示例
│   ├── example_realtime_simulation.py  # 实时模拟示例
│   └── example_day*.py                 # 其他示例
│
└── docs/
    └── 模拟盘使用指南.md  # 详细文档（如果有）
```

---

## ⚠️ 重要提示

### 你现在可以：
1. ✅ 直接运行示例代码进行回测
2. ✅ 使用4个内置策略
3. ✅ 开发自己的策略
4. ✅ 查看完整的性能分析和图表

### 不需要：
- ❌ 不需要再开发基础框架（已完成）
- ❌ 不需要实现回测系统（已实现）
- ❌ 不需要从零开始（有示例代码）

---

## 🎯 总结

**"开始实际量化策略开发和回测"** 的意思是：

> 系统的**底层架构和基础设施已经完成**（C++核心、Python业务层、数据库、风控等），现在可以**专注于策略本身的开发和测试**，而不用再关心底层实现。

**项目中已经有**:
- ✅ 完整的回测系统
- ✅ 4个内置策略
- ✅ 性能分析工具
- ✅ 可视化图表
- ✅ 示例代码

**你可以立即开始**:
```bash
# 1. 运行示例
python examples/example_simple_backtest.py

# 2. 或者自己写策略并回测
python your_strategy.py
```

---

**项目已经ready，可以开始写策略了！** 🚀

